<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Shinmon Live | Premium</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #ff0040; --bg: #0f0f0f; --surface: #1e1e1e; --text: #fff; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { background: var(--bg); color: var(--text); padding-bottom: 50px; }

        /* Modern Header */
        header {
            position: sticky; top: 0; z-index: 100;
            background: rgba(15, 15, 15, 0.9); backdrop-filter: blur(12px);
            padding: 15px 20px; display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid #333;
        }
        .logo { font-size: 1.4rem; font-weight: 700; color: #fff; display: flex; align-items: center; gap: 8px; }
        .logo span { color: var(--primary); }
        .live-dot { width: 8px; height: 8px; background: red; border-radius: 50%; box-shadow: 0 0 10px red; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% {opacity:1;} 50% {opacity:0.4;} 100% {opacity:1;} }

        /* Video Player */
        .player-container {
            width: 100%; position: sticky; top: 60px; z-index: 90;
            background: #000; padding-top: 56.25%; position: relative;
        }
        video { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }

        /* Controls */
        .info-bar {
            padding: 15px; background: var(--surface); display: flex; justify-content: space-between;
            align-items: center; border-radius: 0 0 15px 15px;
        }
        .ch-name { font-size: 1.1rem; font-weight: 600; }
        .ch-status { font-size: 0.8rem; color: #00ff88; }

        /* Channel List */
        .list-area { padding: 15px; }
        .section-title { font-size: 0.9rem; color: #888; margin-bottom: 10px; text-transform: uppercase; }
        
        .channel-card {
            display: flex; align-items: center; gap: 15px; background: var(--surface);
            padding: 12px; margin-bottom: 10px; border-radius: 12px;
            cursor: pointer; transition: 0.3s; border: 1px solid transparent;
        }
        .channel-card:hover { background: #2a2a2a; }
        .channel-card.active { border-color: var(--primary); background: rgba(255, 0, 64, 0.1); }

        .avatar {
            width: 45px; height: 45px; background: #333; border-radius: 10px;
            display: flex; align-items: center; justify-content: center;
            font-weight: bold; font-size: 1.2rem; color: #ccc;
        }
    </style>
</head>
<body>

    <header>
        <div class="logo"><i class="fas fa-play"></i> Shinmon <span>Live</span></div>
        <div class="live-dot"></div>
    </header>

    <div class="player-container">
        <video id="videoPlayer" controls autoplay playsinline></video>
    </div>

    <div class="info-bar">
        <div>
            <div class="ch-name" id="title">Loading...</div>
            <div class="ch-status">‚óè Connected Securely</div>
        </div>
        <a href="https://t.me/YOUR_BOT" target="_blank" style="color:#0088cc; font-size:1.5rem;"><i class="fab fa-telegram"></i></a>
    </div>

    <!-- Adsterra Ad -->
    <div style="margin:10px 0; background:#111; min-height:50px; text-align:center;">
        <script async="async" data-cfasync="false" src="https://pl28692922.effectivegatecpm.com/00c8fb4e64ed914fcdd25533f00f90d8/invoke.js"></script>
        <div id="container-00c8fb4e64ed914fcdd25533f00f90d8"></div>
    </div>

    <div class="list-area">
        <div class="section-title">Live Channels</div>
        <div id="channelList"></div>
    </div>

    <script>
        const player = document.getElementById('videoPlayer');
        const listDiv = document.getElementById('channelList');
        const titleLabel = document.getElementById('title');

        // Fetch Channels from Python Backend
        fetch('/api/channels')
            .then(res => res.json())
            .then(data => {
                listDiv.innerHTML = "";
                const ids = Object.keys(data);

                if(ids.length > 0) {
                    playChannel(ids[0], data[ids[0]]); // Auto Play first
                }

                ids.forEach(id => {
                    const ch = data[id];
                    const div = document.createElement('div');
                    div.className = 'channel-card';
                    div.id = `c-${id}`;
                    div.innerHTML = `
                        <div class="avatar" style="background:${stringToColor(ch.name)}">${ch.name.substring(0,2).toUpperCase()}</div>
                        <div style="flex:1;">
                            <div style="font-weight:600;">${ch.name}</div>
                            <div style="font-size:0.8rem; color:#888;">${ch.cat}</div>
                        </div>
                        <i class="fas fa-play-circle" style="color:#666;"></i>
                    `;
                    div.onclick = () => playChannel(id, ch);
                    listDiv.appendChild(div);
                });
            });

        function playChannel(id, ch) {
            // Use Proxy Stream
            const streamLink = window.location.origin + "/stream/" + id;
            player.src = streamLink;
            player.play().catch(e => console.log(e));
            titleLabel.innerText = ch.name;

            // Highlight
            document.querySelectorAll('.channel-card').forEach(c => c.classList.remove('active'));
            const active = document.getElementById(`c-${id}`);
            if(active) active.classList.add('active');
            
            window.scrollTo({top:0, behavior:'smooth'});
        }

        // Helper: Generate consistent color from name
        function stringToColor(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                hash = str.charCodeAt(i) + ((hash << 5) - hash);
            }
            const c = (hash & 0x00FFFFFF).toString(16).toUpperCase();
            return "#" + "00000".substring(0, 6 - c.length) + c;
        }
    </script>
</body>
</html>